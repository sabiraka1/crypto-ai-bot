Metadata-Version: 2.4
Name: crypto-ai-bot
Version: 0.1.0
Summary: Production-ready ASGI trading bot (Gate.io via CCXT), long-only, paper/live parity, protective exits, reconciliation, observability
Author: Sabir Sahbaz
License: MIT
Requires-Python: >=3.11
Description-Content-Type: text/markdown
Requires-Dist: fastapi<1.0,>=0.115
Requires-Dist: uvicorn[standard]<0.31,>=0.30
Requires-Dist: gunicorn<22,>=21.2
Requires-Dist: httpx<0.28,>=0.27
Requires-Dist: ccxt<5,>=4.2
Requires-Dist: prometheus-client<0.21,>=0.20
Requires-Dist: pydantic<3,>=2.7
Requires-Dist: requests<3,>=2.31
Provides-Extra: charts
Requires-Dist: matplotlib<3.10,>=3.8; extra == "charts"
Provides-Extra: backtest
Requires-Dist: numpy<2.0,>=1.26; extra == "backtest"
Requires-Dist: pandas<3.0,>=2.2; extra == "backtest"
Provides-Extra: dev
Requires-Dist: pytest<9,>=8.2; extra == "dev"
Requires-Dist: pytest-asyncio<1,>=0.23; extra == "dev"
Requires-Dist: pytest-mock<4,>=3.12; extra == "dev"
Requires-Dist: coverage<8,>=7.4; extra == "dev"
Requires-Dist: ruff<0.7,>=0.6; extra == "dev"
Requires-Dist: pre-commit<4,>=3.6; extra == "dev"
Requires-Dist: mypy<2,>=1.8; extra == "dev"
Requires-Dist: import-linter<3,>=2.0; extra == "dev"
Requires-Dist: black<25,>=24.0; extra == "dev"
Requires-Dist: isort<6,>=5.13; extra == "dev"

# crypto-ai-bot

–ê–≤—Ç–æ—Ç—Ä–µ–π–¥–∏–Ω–≥ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç (Gate.io —á–µ—Ä–µ–∑ CCXT) —Å –µ–¥–∏–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –¥–ª—è **paper** –∏ **live**:
`strategies ‚Üí regime filter ‚Üí risk/limits ‚Üí execute_trade ‚Üí protective_exits ‚Üí reconcile ‚Üí watchdog`.

- **–ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ `app / core (application ‚Üí domain ‚Üí infrastructure) / utils`.
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**: –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, –æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª–∏ —Ä–∏—Å–∫–æ–≤, –∑–∞—â–∏—Ç–Ω—ã–µ –≤—ã—Ö–æ–¥—ã, DMS/InstanceLock.
- **–ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å**: Prometheus-–º–µ—Ç—Ä–∏–∫–∏, —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –ª–æ–≥–∏, Telegram-–∞–ª–µ—Ä—Ç—ã.
- **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ø–µ—Ä–µ—Å–±–æ—Ä –ø–æ–∑–∏—Ü–∏–π –∏ —Ñ–∏–∫—Å–∞—Ü–∏—è —á–∞—Å—Ç–∏—á–Ω—ã—Ö –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–π —á–µ—Ä–µ–∑ reconciliation/settlement.

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1) –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
python -m venv .venv
# Windows (PowerShell)
.\.venv\Scripts\Activate.ps1
# Linux/macOS
source .venv/bin/activate

pip install -U pip wheel
pip install -e .
2) –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ .env.example ‚Üí .env –∏ –∑–∞–¥–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (—Ä–µ–∂–∏–º, —Å–∏–º–≤–æ–ª—ã, –ª–∏–º–∏—Ç—ã, –∫–ª—é—á–∏ –¥–ª—è live).
–°–µ–∫—Ä–µ—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –∫–∞–∫ *_FILE, *_B64 –∏–ª–∏ –µ–¥–∏–Ω—ã–º SECRETS_FILE (JSON).

3) –ó–∞–ø—É—Å–∫ API (–ª–æ–∫–∞–ª—å–Ω–æ)
bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
uvicorn crypto_ai_bot.app.server:app --host 0.0.0.0 --port 8000
4) CLI (—Å–µ—Ä–≤–∏—Å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã)
bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∫–∏/–∑–∞–ø—É—Å–∫–∞
cab-smoke

# –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –ë–î
cab-maintenance backup
cab-maintenance rotate --days 30
cab-maintenance vacuum
cab-maintenance integrity
cab-maintenance list

# –°–≤–µ—Ä–∫–∏
cab-reconcile

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ health (–∫–æ–≥–¥–∞ API –∑–∞–ø—É—â–µ–Ω)
cab-health --oneshot --url http://127.0.0.1:8000/health

# –û—Ç—á—ë—Ç –ø–æ —Å–¥–µ–ª–∫–∞–º/PNL/—á–∞—Å—Ç–æ—Ç–µ –∑–∞ —Å–µ–≥–æ–¥–Ω—è (FIFO)
cab-perf
üîå HTTP-—ç–Ω–¥–ø–æ–π–Ω—Ç—ã
GET /health ‚Äî –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (—Å–µ—Ä–¥—Ü–µ–±–∏–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤, —à–∏–Ω—ã, –ë–î).

GET /ready ‚Äî –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å (200/503), –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞.

GET /metrics ‚Äî Prometheus.

GET /orchestrator/status?symbol=BTC/USDT ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

POST /orchestrator/(start|stop|pause|resume)?symbol=... ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (—á–µ—Ä–µ–∑ Bearer API_TOKEN).

GET /pnl/today?symbol=... ‚Äî PnL –∑–∞ —Å–µ–≥–æ–¥–Ω—è (FIFO) –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞.

ü§ñ Telegram-–±–æ—Ç (–æ–ø–µ—Ä–∞—Ç–æ—Ä—Å–∫–∏–π –ø—É–ª—å—Ç)
–ü—Ä–∏–º–µ—Ä—ã –ø–æ–ª–µ–∑–Ω—ã—Ö –∫–æ–º–∞–Ω–¥:

/status ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (running/paused, —Ü–∏–∫–ª—ã, –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã).

/today ‚Äî —Å–¥–µ–ª–∫–∏/turnover/PnL –∑–∞ —Å–µ–≥–æ–¥–Ω—è.

/pnl ‚Äî PnL (FIFO) –∏ –∫–æ—Ä–æ—Ç–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞.

/position ‚Äî –ø–æ–∑–∏—Ü–∏—è –ø–æ —Å–∏–º–≤–æ–ª—É.

/balance ‚Äî –±–∞–ª–∞–Ω—Å—ã base/quote.

/limits ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–µ –ª–∏–º–∏—Ç—ã —Ä–∏—Å–∫–∞.

/pause / /resume / /stop ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ.

/health ‚Äî —Å–≤–æ–¥–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–±–∏—Ä–∂–∞, –ë–î, —à–∏–Ω–∞, —Å–µ—Ç—å).

–ï—Å–ª–∏ TELEGRAM_* –Ω–µ –∑–∞–¥–∞–Ω—ã ‚Äî –≤—Å–µ telegram-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ no-op (–±–µ–∑–æ–ø–∞—Å–Ω–æ).

üß± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ø—Ä–∞–≤–∏–ª–∞
–°–ª–æ–∏:

app/ ‚Äî HTTP API (FastAPI), DI/compose, –∞–¥–∞–ø—Ç–µ—Ä Telegram.

core/application/ ‚Äî –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä, use-cases, protective exits, reconciliation, monitoring.

core/domain/ ‚Äî —á–∏—Å—Ç–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞: risk-–ø–æ–ª–∏—Ç–∏–∫–∏, —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, —Å–∏–≥–Ω–∞–ª—ã, –º–∞–∫—Ä–æ-—Ä–µ–∂–∏–º—ã.

core/infrastructure/ ‚Äî –±—Ä–æ–∫–µ—Ä—ã (CCXT/Paper), —à–∏–Ω–∞ (Redis/in-memory), storage/migrations, safety (DMS/lock), settings.

utils/ ‚Äî –±–∞–∑–æ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã: Decimal, –≤—Ä–µ–º—è, –ª–æ–≥–∏, –º–µ—Ç—Ä–∏–∫–∏, retry, breaker, http, pnl, trace (CID).

–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã:

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–∏—Ç–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ core/infrastructure/settings.py.

–î–µ–Ω–µ–∂–Ω—ã–µ –≤–µ–ª–∏—á–∏–Ω—ã ‚Äî —á–µ—Ä–µ–∑ utils.decimal.dec(...) (Decimal).

–í async-–∫–æ–¥–µ –Ω–µ—Ç time.sleep (—Ç–æ–ª—å–∫–æ asyncio.sleep).

domain –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç application/infrastructure.

–°–ª–æ–∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—Ç—Å—è import-linter; –Ω–∞—Ä—É—à–µ–Ω–∏–µ ‚Äî –æ—à–∏–±–∫–∞ CI.

üóÇÔ∏è –ü–æ–ª–Ω–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (—ç—Ç–∞–ª–æ–Ω)
csharp
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
crypto-ai-bot/
‚îú‚îÄ README.md
‚îú‚îÄ pyproject.toml
‚îú‚îÄ requirements.txt  requirements-dev.txt
‚îú‚îÄ Makefile  Procfile  .gitignore  pytest.ini  importlinter.ini
‚îú‚îÄ ops/
‚îÇ  ‚îî‚îÄ prometheus/
‚îÇ     ‚îú‚îÄ prometheus.yml  alertmanager.yml  alerts.yml  docker-compose.yml
‚îú‚îÄ scripts/
‚îÇ  ‚îú‚îÄ backup_db.py  rotate_backups.py  integrity_check.py
‚îÇ  ‚îú‚îÄ run_server.sh  run_server.ps1
‚îî‚îÄ src/crypto_ai_bot/
   ‚îú‚îÄ app/
   ‚îÇ  ‚îú‚îÄ server.py
   ‚îÇ  ‚îú‚îÄ compose.py
   ‚îÇ  ‚îî‚îÄ adapters/
   ‚îÇ     ‚îî‚îÄ telegram.py
   ‚îú‚îÄ cli/
   ‚îÇ  ‚îú‚îÄ smoke.py
   ‚îÇ  ‚îú‚îÄ maintenance.py
   ‚îÇ  ‚îú‚îÄ reconcile.py
   ‚îÇ  ‚îî‚îÄ performance.py
   ‚îú‚îÄ core/
   ‚îÇ  ‚îú‚îÄ application/
   ‚îÇ  ‚îÇ  ‚îú‚îÄ orchestrator.py
   ‚îÇ  ‚îÇ  ‚îú‚îÄ protective_exits.py
   ‚îÇ  ‚îÇ  ‚îú‚îÄ use_cases/
   ‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ eval_and_execute.py
   ‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ execute_trade.py
   ‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ place_order.py
   ‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ partial_fills.py
   ‚îÇ  ‚îÇ  ‚îú‚îÄ reconciliation/
   ‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ orders.py  positions.py  balances.py
   ‚îÇ  ‚îÇ  ‚îî‚îÄ monitoring/
   ‚îÇ  ‚îÇ     ‚îú‚îÄ health_checker.py  dlq_subscriber.py
   ‚îÇ  ‚îú‚îÄ domain/
   ‚îÇ  ‚îÇ  ‚îú‚îÄ risk/
   ‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ manager.py
   ‚îÇ  ‚îÇ  ‚îú‚îÄ strategies/
   ‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ __init__.py  base.py  manager.py
   ‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ ema_cross.py  rsi_momentum.py  bollinger_bands.py  ema_atr.py
   ‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ position_sizing.py
   ‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ exit_policies.py
   ‚îÇ  ‚îÇ  ‚îú‚îÄ signals/
   ‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ _build.py  _fusion.py  policy.py
   ‚îÇ  ‚îÇ  ‚îî‚îÄ macro/
   ‚îÇ  ‚îÇ     ‚îî‚îÄ types.py
   ‚îÇ  ‚îî‚îÄ infrastructure/
   ‚îÇ     ‚îú‚îÄ settings.py
   ‚îÇ     ‚îú‚îÄ events/
   ‚îÇ     ‚îÇ  ‚îú‚îÄ topics.py  bus.py  redis_bus.py
   ‚îÇ     ‚îú‚îÄ brokers/
   ‚îÇ     ‚îÇ  ‚îú‚îÄ base.py  ccxt_adapter.py  paper.py  symbols.py
   ‚îÇ     ‚îú‚îÄ safety/
   ‚îÇ     ‚îÇ  ‚îú‚îÄ dead_mans_switch.py  instance_lock.py
   ‚îÇ     ‚îú‚îÄ storage/
   ‚îÇ     ‚îÇ  ‚îú‚îÄ facade.py  sqlite_adapter.py  backup.py
   ‚îÇ     ‚îÇ  ‚îú‚îÄ migrations/
   ‚îÇ     ‚îÇ  ‚îÇ  ‚îú‚îÄ V0001__init.sql
   ‚îÇ     ‚îÇ  ‚îÇ  ‚îú‚îÄ ...
   ‚îÇ     ‚îÇ  ‚îÇ  ‚îú‚îÄ V0006__trades_indexes.sql
   ‚îÇ     ‚îÇ  ‚îÇ  ‚îî‚îÄ V0007__idempotency_unique.sql
   ‚îÇ     ‚îÇ  ‚îî‚îÄ repositories/
   ‚îÇ     ‚îÇ     ‚îú‚îÄ trades.py  positions.py  market_data.py  audit.py  idempotency.py
   ‚îÇ     ‚îî‚îÄ macro/
   ‚îÇ        ‚îî‚îÄ sources/
   ‚îÇ           ‚îú‚îÄ http_dxy.py  http_btc_dominance.py  http_fomc.py
   ‚îî‚îÄ utils/
      ‚îú‚îÄ decimal.py  time.py  ids.py  logging.py
      ‚îú‚îÄ metrics.py  retry.py  circuit_breaker.py  exceptions.py
      ‚îú‚îÄ http_client.py  pnl.py  symbols.py  trace.py
–ü–∞–ø–∫–∏ –≤—Ä–æ–¥–µ core/application/signals –∏–ª–∏ core/domain/indicators –¥–æ–ª–∂–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å, –µ—Å–ª–∏ –ø—É—Å—Ç—ã–µ (–≤–æ –∏–∑–±–µ–∂–∞–Ω–∏–µ –ø—É—Ç–∞–Ω–∏—Ü—ã).

üîÑ –¢–æ—Ä–≥–æ–≤—ã–π –∫–æ–Ω–≤–µ–π–µ—Ä (–ª–æ–≥–∏–∫–∞)
MarketData: –ø–æ–ª—É—á–µ–Ω–∏–µ OHLCV/ticker –∏–∑ –±—Ä–æ–∫–µ—Ä–∞ (–≤ paper –∏ live –æ–¥–∏–Ω–∞–∫–æ–≤–æ).

StrategyManager: –ø—É–ª —Å—Ç—Ä–∞—Ç–µ–≥–∏–π (ema_cross, ema_atr, rsi_momentum, bollinger_bands, signals_policy) –∏ —Ä–µ–∂–∏–º –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:

first (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), vote –∏–ª–∏ weighted (–≤–µ—Å–∞ –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å ENV-–æ–º).

Regime filter (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ø–æ DXY/BTC.D/FOMC ‚Äî –±–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ buy –≤ risk_off –∏–ª–∏ —É–º–µ–Ω—å—à–∞–µ—Ç –≤–µ—Å –≤ weighted.

Position Sizer: fixed | fractional | volatility | kelly ‚Äî —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—É–º–º—É –≤ –∫–æ—Ç–∏—Ä—É–µ–º–æ–π –≤–∞–ª—é—Ç–µ —Å —É—á—ë—Ç–æ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

RiskManager: —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã/–±—é–¥–∂–µ—Ç/—Å–ø—Ä–µ–¥/–∫—É–ª–¥–∞—É–Ω—ã/–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (–æ–¥–Ω–æ –º–µ—Å—Ç–æ –∏—Å—Ç–∏–Ω—ã). –ü—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ ‚Äî trade.blocked.

Execute trade: —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ç-–æ—Ä–¥–µ—Ä–∞ —á–µ—Ä–µ–∑ –±—Ä–æ–∫–µ—Ä/CCXT (–≤ paper ‚Äî —Å–∏–º—É–ª–∏—Ä—É–µ—Ç—Å—è —Ç–µ–º–∏ –∂–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏).

ProtectiveExits: —Å—Ç–æ–ø-–ª–æ—Å—Å, —Ç–µ–π–∫, —Ç—Ä–µ–π–ª–∏–Ω–≥ (–º–æ–¥—É–ª—å –≤–∫–ª—é—á–∞–µ—Ç—Å—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º).

Reconcile: —Å–≤–µ—Ä–∫–∞ –ø–æ–∑–∏—Ü–∏–π/–±–∞–ª–∞–Ω—Å–æ–≤ –∏ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤, –æ—á–∏—Å—Ç–∫–∞ ¬´—Ö–≤–æ—Å—Ç–æ–≤¬ª, —Ñ–∏–∫—Å–∞—Ü–∏—è —á–∞—Å—Ç–∏—á–Ω—ã—Ö –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–π.

Settlement: –¥–æ–≤–µ–¥–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫ –¥–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ (trade.settled/trade.failed_settlement).

üíº Risk & Idempotency
Idempotency: –∫–ª—é—á –≤ –ë–î —Å TTL –∏ UNIQUE(clientOrderId); –æ–∫–Ω–æ IDEMPOTENCY_BUCKET_MS.

–õ–∏–º–∏—Ç—ã:

RISK_MAX_SPREAD_PCT ‚Äî –º–∞–∫—Å–∏–º—É–º –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ —Å–ø—Ä–µ–¥–∞, –∏–Ω–∞—á–µ –±–ª–æ–∫.

RISK_MAX_POSITION_BASE ‚Äî –º–∞–∫—Å–∏–º—É–º –ø–æ–∑–∏—Ü–∏–∏ –≤ –±–∞–∑–æ–≤–æ–π –≤–∞–ª—é—Ç–µ.

RISK_DAILY_LOSS_LIMIT_QUOTE ‚Äî –¥–Ω–µ–≤–Ω–æ–π —É–±—ã—Ç–æ–∫ (–∫–æ—Ç–∏—Ä—É–µ–º–∞—è).

RISK_MAX_ORDERS_PER_HOUR –∏ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å RISK_MAX_ORDERS_5M.

RISK_MAX_FEE_PCT, RISK_MAX_SLIPPAGE_PCT.

DMS/InstanceLock (—Ç–æ–ª—å–∫–æ live) ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏–π –∏ –¥–≤–æ–π–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞.

üßÆ PnL –∏ FIFO
–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã ‚Äî FIFO-–∞–ª–≥–æ—Ä–∏—Ç–º –≤ utils/pnl.py.
/pnl/today –∏ CLI-–æ—Ç—á—ë—Ç—ã —Å—á–∏—Ç–∞—é—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π PnL —á–µ—Ä–µ–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π trades, —É—á–∏—Ç—ã–≤–∞—è —á–∞—Å—Ç–∏—á–Ω—ã–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –∫–æ–º–∏—Å—Å–∏–∏.

üõ∞Ô∏è –®–∏–Ω–∞ —Å–æ–±—ã—Ç–∏–π
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é in-memory; –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ —É–∫–∞–∂–∏—Ç–µ EVENT_BUS_URL=redis://....

–¢–µ–º—ã: trade.completed/failed/settled/blocked, budget.exceeded, orchestrator.auto_*, safety.dms.*, reconcile.*, dlq.*.

–ü–æ–¥–ø–∏—Å—á–∏–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –ø–æ—Å–ª–µ —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–∞.

üìà –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å
/metrics ‚Äî Prometheus; utils/metrics.py –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Counter/Gauge/Histogram –∏ helper observe(...).

–°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –ª–æ–≥–∏ (JSON) —Å–æ —Å—Ç–µ–∫–æ–º –¥–ª—è –æ—à–∏–±–æ–∫; –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è –ø–æ CID (—Å–º. utils/trace.py).

Telegram-–∞–ª–µ—Ä—Ç—ã –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–æ–±—ã—Ç–∏—è–º (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Ç–æ–∫–µ–Ω/—á–∞—Ç/—Å–µ–∫—Ä–µ—Ç).

‚öôÔ∏è ENV (—Å–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞)
–†–µ–∂–∏–º—ã –∏ –±–∏—Ä–∂–∞
MODE=paper|live

EXCHANGE=gateio

SYMBOL=BTC/USDT –∏–ª–∏ SYMBOLS=BTC/USDT,ETH/USDT

–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏ —Ä–µ–∂–∏–º –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
STRATEGY_SET=ema_cross,ema_atr,signals_policy

STRATEGY_MODE=first|vote|weighted (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é first)

STRATEGY_SCORES=ema_cross:1.0,ema_atr:1.2,signals_policy:1.5

MarketData / –æ–∫–Ω–∞
STRAT_TIMEFRAME=1m

STRAT_OHLCV_LIMIT=200

Regime filter
REGIME_ENABLED=1

REGIME_BLOCK_BUY=1

REGIME_WEIGHT_MULT_RISK_OFF=0.5

DXY_SOURCE_URL=

BTC_DOM_SOURCE_URL=

FOMC_CALENDAR_URL=

–ü–æ—Ä–æ–≥–∏: REGIME_DXY_UP_PCT=0.5, REGIME_DXY_DOWN_PCT=-0.2, REGIME_BTC_DOM_UP_PCT=0.5, REGIME_BTC_DOM_DOWN_PCT=-0.5, REGIME_FOMC_BLOCK_MIN=60

Position sizing
POSITION_SIZER=fixed|fractional|volatility|kelly (–¥–µ—Ñ–æ–ª—Ç: fractional)

STRAT_QUOTE_FRACTION=0.05

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
SIZE_MAX_QUOTE_PCT=0.2, SIZE_MIN_QUOTE=0, SIZE_MAX_QUOTE=0

–î–ª—è Kelly:
KELLY_WIN_RATE=0.5, KELLY_AVG_WIN_PCT=1.0, KELLY_AVG_LOSS_PCT=1.0

–†–∏—Å–∫–∏/–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å/–∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
FEE_PCT_ESTIMATE=0.001

RISK_COOLDOWN_SEC=0

RISK_MAX_SPREAD_PCT=0.5

RISK_MAX_POSITION_BASE=0

RISK_MAX_ORDERS_PER_HOUR=10 (RISK_MAX_ORDERS_5M=10 ‚Äî —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)

RISK_DAILY_LOSS_LIMIT_QUOTE=50

RISK_MAX_FEE_PCT=0.2

RISK_MAX_SLIPPAGE_PCT=1.0

IDEMPOTENCY_BUCKET_MS=60000

IDEMPOTENCY_TTL_SEC=120

–ò–Ω—Ç–µ—Ä–≤–∞–ª—ã —Ü–∏–∫–ª–æ–≤:
EVAL_INTERVAL_SEC=3, EXITS_INTERVAL_SEC=5, RECONCILE_INTERVAL_SEC=10, WATCHDOG_INTERVAL_SEC=3, SETTLEMENT_INTERVAL_SEC=7

–ö–ª—é—á–∏/—Å–µ–∫—Ä–µ—Ç—ã/–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
API_KEY, API_SECRET –∏–ª–∏ API_KEY_FILE/API_SECRET_FILE –∏–ª–∏ API_KEY_B64/API_SECRET_B64 –∏–ª–∏ SECRETS_FILE

Telegram: TELEGRAM_BOT_TOKEN, TELEGRAM_BOT_SECRET, TELEGRAM_CHAT_ID

Bus/Store/Service: EVENT_BUS_URL, DB_PATH, HTTP_TIMEOUT_SEC, LOG_LEVEL, API_TOKEN

üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
Unit: —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏/—Ä–∏—Å–∫/—Å–∞–π–∑–∏–Ω–≥/PnL (pytest).

Smoke: cab-smoke ‚Äî –±—ã—Å—Ç—Ä—ã–π –ø—Ä–æ–≥–æ–Ω API –∏ —Ü–∏–∫–ª–æ–≤.

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: paper-–∑–∞–ø—É—Å–∫ –Ω–∞ –∫–æ—Ä–æ—Ç–∫–æ–º –æ–∫–Ω–µ; –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤ –∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏.

(–û–ø—Ü.) Backtest/Replay: –º–æ–¥—É–ª—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è OHLCV —Å–æ —Å–≤–æ–¥–∫–æ–π –º–µ—Ç—Ä–∏–∫ (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è).

üöÄ –î–µ–ø–ª–æ–π (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π)
–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å uvicorn + Prometheus sidecar (–∏–ª–∏ node-exporter).

Redis –∫–∞–∫ —à–∏–Ω–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –¥–ª—è live).

–û—Ç–¥–µ–ª—å–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è DB_PATH –∏ –±—ç–∫–∞–ø–æ–≤.

CI: ruff + mypy + import-linter + pytest.

üõ†Ô∏è –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ
–ë—ç–∫–∞–ø—ã: cab-maintenance backup + rotate.

–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å: cab-maintenance integrity.

–°–≤–µ—Ä–∫–∏: cab-reconcile.

–û—Ç—á—ë—Ç–Ω–æ—Å—Ç—å: cab-perf –∏ GET /pnl/today.

‚ùì –¢—Ä–∞–±–ª—à—É—Ç–∏–Ω–≥
–ù–µ—Ç —Å–¥–µ–ª–æ–∫ –≤ paper: –ø—Ä–æ–≤–µ—Ä—å STRATEGY_SET/STRATEGY_MODE, POSITION_SIZER, –ø–æ—Ä–æ–≥–∏ —Ä–∏—Å–∫–∞ –∏ REGIME_* (–≤ risk_off –Ω–æ–≤—ã–µ buy –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è).

429/—Ç–∞–π–º–∞—É—Ç—ã: —É–≤–µ–ª–∏—á—å—Ç–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã, –≤–∫–ª—é—á–∏—Ç–µ –∫—ç—à OHLCV, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏–º–∏—Ç—ã API.

–ù–µ—Ç –º–µ—Ç—Ä–∏–∫/–∞–ª–µ—Ä—Ç–æ–≤: –ø—Ä–æ–≤–µ—Ä—å /metrics, —Ç–æ–∫–µ–Ω—ã/—á–∞—Ç Telegram, —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–æ–≤.

üìú –õ–∏—Ü–µ–Ω–∑–∏—è
MIT (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –∏–Ω–æ–µ –≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è).
