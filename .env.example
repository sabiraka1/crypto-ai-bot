###############################################################################
# crypto-ai-bot — пример конфигурации (.env.example)
# Безопасные дефолты под PAPER. Для LIVE — см. соответствующие блоки.
# Формат: строки "КЛЮЧ=ЗНАЧЕНИЕ". Пустые/комментированные строки игнорируются.
###############################################################################

############################
# 0) БАЗА + РЕЖИМ ЗАПУСКА #
############################
MODE=paper                 # paper | live
EXCHANGE=gateio            # ccxt-ид биржи (пример: binance, bybit, okx, gateio)
SYMBOL=BTC/USDT            # основной символ (оркестратор)
# SYMBOLS=BTC/USDT,ETH/USDT  # (опц.) список символов, если вы запускаете несколько оркестраторов

# Путь к БД (SQLite)
DB_PATH=./data/trading.db

# Шина событий (in-memory по умолчанию). Для продакшена рекомендуем Redis:
# EVENT_BUS_URL=redis://localhost:6379/0
EVENT_BUS_URL=

# API-сервер
API_HOST=0.0.0.0
API_PORT=8000
# Токен для защищённых эндпойнтов (POST /orchestrator/*)
API_TOKEN=changeme_api_token

# Логирование
LOG_LEVEL=INFO             # DEBUG|INFO|WARNING|ERROR
# Диапазоны buckets для гистограмм метрик (миллисекунды)
METRICS_BUCKETS_MS=5,10,25,50,100,250,500,1000

# HTTP-клиент (для макро-источников и прочего)
HTTP_TIMEOUT=5.0           # сек (используется в новом коде)
# HTTP_TIMEOUT_SEC=5.0     # (legacy) если где-то используется старое имя — можно оставить

################################
# 1) ДОСТУПЫ К БИРЖЕ (CCXT/LIVE)
################################
# PAPER-режим может работать БЕЗ ключей (в зависимости от адаптера).
# Для LIVE заполните ключи одним из способов:
#   прямые переменные, *_FILE (путь к файлу), *_B64 (base64), или общий SECRETS_FILE (JSON).
API_KEY=
API_SECRET=
# API_KEY_FILE=
# API_SECRET_FILE=
# API_KEY_B64=
# API_SECRET_B64=
# SECRETS_FILE=./secrets.json     # формат: {"API_KEY":"...","API_SECRET":"..."}

#####################################
# 2) СТРАТЕГИИ, МЕНЕДЖЕР, РЕЖИМЫ РЫНКА
#####################################
# Набор стратегий (доступные: ema_cross, ema_atr, rsi_momentum, bollinger_bands, signals_policy)
STRATEGY_SET=ema_cross,ema_atr,signals_policy
# Режим агрегирования: first | vote | weighted
STRATEGY_MODE=first

# Веса стратегий (для weighted): comma-separated "name:weight"
# Имя = короткое от класса без "Strategy" (ema_cross, ema_atr, rsi_momentum, bollinger_bands, signals_policy)
# Пример: STRATEGY_SCORES=ema_cross:1.0,ema_atr:1.2,signals_policy:1.5
STRATEGY_SCORES=

# Окна данных
STRAT_TIMEFRAME=1m
STRAT_OHLCV_LIMIT=200

# Режимный фильтр (DXY / BTC.D / FOMC)
REGIME_ENABLED=1
REGIME_BLOCK_BUY=1                 # в risk_off блокировать новые buy (для first/vote/weighted)
REGIME_WEIGHT_MULT_RISK_OFF=0.5    # в weighted уменьшаем суммарный вес buy
# Пороги (в процентах)
REGIME_DXY_UP_PCT=0.5
REGIME_DXY_DOWN_PCT=-0.2
REGIME_BTC_DOM_UP_PCT=0.5
REGIME_BTC_DOM_DOWN_PCT=-0.5
REGIME_FOMC_BLOCK_MIN=60
# Источники (можно оставить пустыми — тогда режим всегда "range")
DXY_SOURCE_URL=
BTC_DOM_SOURCE_URL=
FOMC_CALENDAR_URL=

#####################################
# 3) ПОЗИЦИОНИРОВАНИЕ (РАЗМЕР СДЕЛКИ)
#####################################
# Выбор сайзера: fixed | fractional | volatility | kelly
POSITION_SIZER=fractional

# Базовые параметры размера
FIXED_AMOUNT=0                  # фикс в котируемой (если POSITION_SIZER=fixed)
STRAT_QUOTE_FRACTION=0.05       # доля от свободного котируемого баланса (fractional/volatility/kelly)

# Ограничения на размер
SIZE_MAX_QUOTE_PCT=0.2          # не более 20% от свободного баланса
SIZE_MIN_QUOTE=0
SIZE_MAX_QUOTE=0

# Target-volatility (используется в POSITION_SIZER=volatility)
TARGET_PORTFOLIO_VOL_PCT=0.5    # целевая портфельная вола (%)

# Kelly (используется в POSITION_SIZER=kelly)
KELLY_WIN_RATE=0.5
KELLY_AVG_WIN_PCT=1.0
KELLY_AVG_LOSS_PCT=1.0

############################
# 4) РИСКИ И ИДЕМПОТЕНТНОСТЬ
############################
# Оценка комиссии по умолчанию (доля), если биржа не вернула точную
FEE_PCT_ESTIMATE=0.001          # 0.1%

# Основные лимиты
RISK_COOLDOWN_SEC=0
RISK_MAX_SPREAD_PCT=0.5         # макс. допустимый спред (%, блокирует рыночный ордер)
RISK_MAX_POSITION_BASE=0        # лимит позиции в базовой валюте (0 = без ограничения)
RISK_DAILY_LOSS_LIMIT_QUOTE=50  # дневной лимит убытка в котируемой (0 = выкл)
RISK_MAX_FEE_PCT=0.2            # максимум комиссий (%, sanity check)
RISK_MAX_SLIPPAGE_PCT=1.0       # максимум проскальзывания (%, sanity check)

# Лимиты на частоту
RISK_MAX_ORDERS_PER_HOUR=10
# Обратная совместимость (если где-то используется старое имя)
RISK_MAX_ORDERS_5M=10

# Идемпотентность (тайм-бакет и TTL)
IDEMPOTENCY_BUCKET_MS=60000
IDEMPOTENCY_TTL_SEC=120

#####################################
# 5) ОРКЕСТРАТОР, ЦИКЛЫ, WATCHDOG
#####################################
EVAL_ENABLED=1
EVAL_INTERVAL_SEC=3
EXITS_ENABLED=1
EXITS_INTERVAL_SEC=5
RECONCILE_ENABLED=1
RECONCILE_INTERVAL_SEC=10
WATCHDOG_ENABLED=1
WATCHDOG_INTERVAL_SEC=3
SETTLEMENT_ENABLED=1
SETTLEMENT_INTERVAL_SEC=7

#####################################
# 6) PROTECTIVE EXITS (СТОП/ТЕЙК/ТРЕЙЛ)
#####################################
# Здесь только флаги включения. Конкретные параметры стопов/тейков могут задаваться
# в коде стратегий или отдельными переменными (если внедрите).
EXITS_STOP_ENABLED=1
EXITS_TAKE_ENABLED=1
EXITS_TRAILING_ENABLED=1

##########################
# 7) TELEGRAM (ОПЦИОНАЛЬНО)
##########################
# Если не задано — интеграция отключится безопасно
TELEGRAM_BOT_TOKEN=
TELEGRAM_BOT_SECRET=changeme_secret
TELEGRAM_CHAT_ID=

##########################################
# 8) DMS / INSTANCE LOCK (ТОЛЬКО ДЛЯ LIVE)
##########################################
# Dead Man’s Switch — остановит торги, если сервис не «пингует» DMS
DMS_ENABLED=0
# Эксклюзивный лок инстанса (чтобы не было двух активных роботов на один символ)
LOCK_ENABLED=0

##########################################
# 9) СОВМЕСТИМОСТЬ / ЛЕГАСИ-ПЕРЕМЕННЫЕ
##########################################
# Если в старом коде встречались эти имена — можно дублировать значения:
HTTP_TIMEOUT_SEC=5.0
