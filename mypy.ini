[mypy]
python_version = 3.11
mypy_path = src
explicit_package_bases = True
namespace_packages = True

# ═══════════════════════════════════════════════════════════════════════════════
# CRYPTO AI BOT TYPE CHECKING - ULTRA STRICT
# ═══════════════════════════════════════════════════════════════════════════════

# ───────────────────────────────────────────────────────────────────────────────
# STRICTNESS LEVELS (production-grade)
# ───────────────────────────────────────────────────────────────────────────────
strict = True
no_implicit_optional = True
strict_optional = True
disallow_untyped_defs = True
disallow_untyped_calls = True
disallow_incomplete_defs = True
disallow_any_generics = True
check_untyped_defs = True
no_implicit_reexport = True
strict_equality = True
strict_concatenate = True

# ───────────────────────────────────────────────────────────────────────────────
# ANY TYPE HARDENING (eliminate escape hatches)
# ───────────────────────────────────────────────────────────────────────────────
disallow_any_unimported = True
disallow_any_expr = True
disallow_any_explicit = True
disallow_any_decorated = True
disallow_subclassing_any = True
warn_return_any = True

# ───────────────────────────────────────────────────────────────────────────────
# WARNINGS AND ERROR REPORTING
# ───────────────────────────────────────────────────────────────────────────────
warn_unreachable = True
warn_no_return = True
warn_redundant_casts = True
warn_unused_ignores = True
warn_unused_configs = True
show_error_codes = True
pretty = True
color_output = True
error_summary = True
show_column_numbers = True

# ───────────────────────────────────────────────────────────────────────────────
# DOMAIN LAYER - ULTRA PURE (business logic only)
# ───────────────────────────────────────────────────────────────────────────────
[mypy-crypto_ai_bot.core.domain.*]
# Maximum strictness for business logic
disallow_any_unimported = True
disallow_any_expr = True
disallow_any_explicit = True
disallow_any_decorated = True
disallow_subclassing_any = True
warn_return_any = True
strict_equality = True

# Financial data must be typed precisely
[mypy-crypto_ai_bot.core.domain.strategies.*]
# Strategy returns must be precisely typed
disallow_incomplete_defs = True
disallow_untyped_defs = True
warn_return_any = True

[mypy-crypto_ai_bot.core.domain.signals.*]
# Signal processing must be type-safe
disallow_any_expr = True
disallow_incomplete_defs = True

[mypy-crypto_ai_bot.core.domain.risk.*]
# Risk calculations are critical - no Any types
disallow_any_expr = True
disallow_any_explicit = True
warn_return_any = True

# ───────────────────────────────────────────────────────────────────────────────
# APPLICATION LAYER - USE CASES AND ORCHESTRATION
# ───────────────────────────────────────────────────────────────────────────────
[mypy-crypto_ai_bot.core.application.*]
# Use cases must be precisely typed
disallow_untyped_defs = True
disallow_incomplete_defs = True
warn_return_any = True

[mypy-crypto_ai_bot.core.application.use_cases.*]
# Critical trading operations - maximum safety
disallow_any_expr = True
disallow_any_explicit = True
strict_equality = True

[mypy-crypto_ai_bot.core.application.orchestrator]
# Orchestration logic must be bulletproof
disallow_any_expr = True
disallow_incomplete_defs = True
warn_return_any = True

[mypy-crypto_ai_bot.core.application.ports]
# Interface definitions must be perfect
disallow_any_generics = True
disallow_any_expr = True
disallow_incomplete_defs = True

# ───────────────────────────────────────────────────────────────────────────────
# INFRASTRUCTURE LAYER - ADAPTERS AND EXTERNAL INTEGRATIONS
# ───────────────────────────────────────────────────────────────────────────────
[mypy-crypto_ai_bot.core.infrastructure.*]
# Infrastructure can be more lenient due to external dependencies
disallow_untyped_defs = True
disallow_incomplete_defs = True
# Allow some Any for external API integration
disallow_any_expr = False
warn_return_any = True

[mypy-crypto_ai_bot.core.infrastructure.brokers.*]
# Broker integration - critical but external
disallow_incomplete_defs = True
warn_return_any = True
# CCXT types are incomplete, so some leniency needed

[mypy-crypto_ai_bot.core.infrastructure.storage.*]
# Database operations must be safe
disallow_untyped_defs = True
disallow_incomplete_defs = True
warn_return_any = True

[mypy-crypto_ai_bot.core.infrastructure.events.*]
# Event system must be type-safe
disallow_incomplete_defs = True
disallow_untyped_defs = True

# ───────────────────────────────────────────────────────────────────────────────
# APP LAYER - HTTP API AND COMPOSITION
# ───────────────────────────────────────────────────────────────────────────────
[mypy-crypto_ai_bot.app.*]
# App layer coordinates everything - moderate strictness
disallow_untyped_defs = True
disallow_incomplete_defs = True
# Allow some flexibility for FastAPI/Telegram integration
warn_return_any = True

[mypy-crypto_ai_bot.app.server]
# FastAPI endpoints must be typed
disallow_incomplete_defs = True
warn_return_any = True

[mypy-crypto_ai_bot.app.compose]
# Dependency injection - critical for wiring
disallow_incomplete_defs = True
disallow_untyped_defs = True

# ───────────────────────────────────────────────────────────────────────────────
# UTILS - SHARED UTILITIES
# ───────────────────────────────────────────────────────────────────────────────
[mypy-crypto_ai_bot.utils.*]
# Utils must be bulletproof - used everywhere
disallow_any_expr = True
disallow_any_explicit = True
disallow_incomplete_defs = True
disallow_untyped_defs = True
warn_return_any = True

[mypy-crypto_ai_bot.utils.decimal]
# Financial calculations - zero tolerance for type errors
disallow_any_expr = True
disallow_any_explicit = True
disallow_any_unimported = True
strict_equality = True

[mypy-crypto_ai_bot.utils.pnl]
# PnL calculations are critical
disallow_any_expr = True
disallow_any_explicit = True
warn_return_any = True

[mypy-crypto_ai_bot.utils.metrics]
# Monitoring must be type-safe
disallow_incomplete_defs = True
disallow_untyped_defs = True

# ───────────────────────────────────────────────────────────────────────────────
# CLI - COMMAND LINE TOOLS
# ───────────────────────────────────────────────────────────────────────────────
[mypy-crypto_ai_bot.cli.*]
# CLI tools - moderate strictness
disallow_untyped_defs = True
disallow_incomplete_defs = True
# Allow some flexibility for CLI argument parsing
warn_return_any = True

# ───────────────────────────────────────────────────────────────────────────────
# THIRD-PARTY LIBRARIES (missing type stubs)
# ───────────────────────────────────────────────────────────────────────────────
[mypy-ccxt.*]
ignore_missing_imports = True
[mypy-ccxt]
ignore_missing_imports = True

[mypy-redis.*]
ignore_missing_imports = True
[mypy-redis]
ignore_missing_imports = True

[mypy-prometheus_client.*]
ignore_missing_imports = True
[mypy-prometheus_client]
ignore_missing_imports = True

[mypy-fastapi.*]
ignore_missing_imports = True
[mypy-fastapi]
ignore_missing_imports = True

[mypy-uvicorn.*]
ignore_missing_imports = True
[mypy-uvicorn]
ignore_missing_imports = True

[mypy-httpx.*]
ignore_missing_imports = True
[mypy-httpx]
ignore_missing_imports = True

[mypy-aioredis.*]
ignore_missing_imports = True
[mypy-aioredis]
ignore_missing_imports = True

[mypy-pandas.*]
ignore_missing_imports = True
[mypy-pandas]
ignore_missing_imports = True

[mypy-numpy.*]
ignore_missing_imports = True
[mypy-numpy]
ignore_missing_imports = True

[mypy-sklearn.*]
ignore_missing_imports = True
[mypy-sklearn]
ignore_missing_imports = True

[mypy-onnxruntime.*]
ignore_missing_imports = True
[mypy-onnxruntime]
ignore_missing_imports = True

[mypy-ta.*]
ignore_missing_imports = True
[mypy-ta]
ignore_missing_imports = True

[mypy-telebot.*]
ignore_missing_imports = True
[mypy-telebot]
ignore_missing_imports = True

[mypy-telegram.*]
ignore_missing_imports = True
[mypy-telegram]
ignore_missing_imports = True

# ───────────────────────────────────────────────────────────────────────────────
# DYNAMIC/MIGRATION AREAS (controlled relaxation)
# ───────────────────────────────────────────────────────────────────────────────
[mypy-crypto_ai_bot.core.infrastructure.storage.migrations.*]
# Migrations can be dynamic
ignore_errors = True

[mypy-crypto_ai_bot.core.infrastructure.storage.migrations.runner]
# Migration runner needs dynamic SQL execution
ignore_errors = True

# ───────────────────────────────────────────────────────────────────────────────
# TESTING (more lenient for test utilities)
# ───────────────────────────────────────────────────────────────────────────────
[mypy-tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_incomplete_defs = False
check_untyped_defs = False
warn_return_any = False
disallow_any_expr = False
# Tests can use fixtures and mocks that are hard to type

[mypy-conftest]
ignore_errors = True

# ───────────────────────────────────────────────────────────────────────────────
# SCRIPTS (operational tools)
# ───────────────────────────────────────────────────────────────────────────────
[mypy-scripts.*]
# Scripts for operations - moderate typing
disallow_untyped_defs = False
disallow_incomplete_defs = False
warn_return_any = False

# ───────────────────────────────────────────────────────────────────────────────
# SPECIAL CASES
# ───────────────────────────────────────────────────────────────────────────────

# Package init files can be minimal
[mypy-crypto_ai_bot.*.__init__]
ignore_missing_imports = True
warn_unused_ignores = False

# Settings can access os module for environment
[mypy-crypto_ai_bot.core.infrastructure.settings]
# Allow os/environ access for configuration
disallow_any_expr = False
warn_return_any = True

# Logging bootstrap needs flexibility
[mypy-crypto_ai_bot.app.logging_bootstrap]
disallow_any_expr = False
warn_return_any = True